<h2><%= title %></h2>

<% if (userRole === '–ó–∞–∫–∞–∑—á–∏–∫' || userRole === '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç') { %>
<div class="card" style="margin-top: 20px; background-color: #f8f9fa; border-left: 4px solid #007bff;">
    <p><strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> 
        <% if (userRole === '–ó–∞–∫–∞–∑—á–∏–∫') { %>
            –î–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –ø–æ –≤–∞—à–∏–º –∑–∞—è–≤–∫–∞–º.
        <% } else if (userRole === '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç') { %>
            –î–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –ø–æ –∑–∞—è–≤–∫–∞–º, –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º –Ω–∞ –≤–∞—Å.
        <% } %>
    </p>
</div>
<% } %>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ä–æ–ª–µ–π) -->
<% if (workshopStats && workshopStats.length > 0 && ['–ú–µ–Ω–µ–¥–∂–µ—Ä', '–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –∫–∞—á–µ—Å—Ç–≤—É', '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç'].includes(userRole)) { %>
<div class="card">
    <h3>
        <% if (userRole === '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç') { %>
            –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç
        <% } else { %>
            –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º
        <% } %>
    </h3>
    
    <table>
        <thead>
            <tr>
                <th>–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è (–¥–Ω–∏)</th>
                <th>–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th>
                <th>–ó–∞–≤–µ—Ä—à–µ–Ω–æ</th>
                <th>–ù–∞–∑–Ω–∞—á–µ–Ω–æ –∑–∞—è–≤–æ–∫</th>
                <th>–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç</th>
            </tr>
        </thead>
        <tbody>
            <% workshopStats.forEach(stat => { %>
            <tr>
                <td><%= stat.avg_time %></td>
                <td><%= stat.completion_rate %>%</td>
                <td><%= stat.completed_count %></td>
                <td><%= stat.assigned_count %></td>
                <td><%= stat.workshop_name %></td>
            </tr>
            <% }) %>
        </tbody>
    </table>
</div>
<% } %>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º -->
<div class="card">
    <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º –∑–∞—è–≤–æ–∫</h3>
    
    <% if (statusStats.length > 0) { %>
    <table>
        <thead>
            <tr>
                <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
            </tr>
        </thead>
        <tbody>
            <% statusStats.forEach(stat => { %>
            <tr>
                <td><%= totalRequests > 0 ? Math.round((stat.count / totalRequests) * 100) : 0 %>%</td>
                <td><%= stat.count %></td>
                <td>
                    <span class="badge" style="background-color: <%= stat.status_color %>;">
                        <%= stat.status_name %>
                    </span>
                </td>
            </tr>
            <% }) %>
        </tbody>
    </table>
    <% } else { %>
    <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
    <% } %>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è -->
<div class="card" style="margin-top: 30px;">
    <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</h3>
    
    <% if (equipmentStats.length > 0) { %>
    <table>
        <thead>
            <tr>
                <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—è–≤–æ–∫</th>
                <th>–¢–∏–ø –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</th>
            </tr>
        </thead>
        <tbody>
            <% equipmentStats.forEach(stat => { %>
            <tr>
                <td><%= totalRequests > 0 ? Math.round((stat.count / totalRequests) * 100) : 0 %>%</td>
                <td><%= stat.count %></td>
                <td><%= stat.type_name %></td>
            </tr>
            <% }) %>
        </tbody>
    </table>
    <% } else { %>
    <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
    <% } %>
</div>

<!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="stats-grid">
    <div class="stat-card">
        <h3><%= avgCompletionTime %></h3>
        <p>–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è (–¥–Ω–∏)</p>
    </div>
    
    <div class="stat-card">
        <h3><%= completedRequests %></h3>
        <p>–ó–∞–≤–µ—Ä—à–µ–Ω–æ</p>
    </div>
    
    <div class="stat-card">
        <h3><%= activeRequests %></h3>
        <p>–í —Ä–∞–±–æ—Ç–µ</p>
    </div>
    
    <div class="stat-card">
        <h3><%= totalRequests %></h3>
        <p>
            <% if (userRole === '–ó–∞–∫–∞–∑—á–∏–∫') { %>
                –í—Å–µ–≥–æ –º–æ–∏—Ö –∑–∞—è–≤–æ–∫
            <% } else if (userRole === '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç') { %>
                –í—Å–µ–≥–æ –º–æ–∏—Ö —Ä–∞–±–æ—Ç
            <% } else { %>
                –í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫
            <% } %>
        </p>
    </div>
</div>

<div class="toolbar">
    <div>
        <span class="info-text">–û–±–Ω–æ–≤–ª–µ–Ω–æ: <%= new Date().toLocaleDateString('ru-RU') %></span>
        <a href="/reports/export-pdf" class="btn btn-primary" style="margin-left: 10px;">
            üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF
        </a>
    </div>
    <div>
        <strong>
            <% if (userRole === '–ó–∞–∫–∞–∑—á–∏–∫') { %>
                –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –≤–∞—à–∏–º –∑–∞—è–≤–∫–∞–º
            <% } else if (userRole === '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç') { %>
                –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –≤–∞—à–∏–º —Ä–∞–±–æ—Ç–∞–º
            <% } else { %>
                –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
            <% } %>
        </strong>
    </div>
</div>